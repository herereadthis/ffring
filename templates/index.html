{% extends 'base.html' %}

{% block body %}
    {% block header %}
        <h1>{% block title %}{{ system['title'] }}{% endblock %}</h1>
    {% endblock %}
    <ul>
        <li class="list_item"><a href="{{ system['tar1090']['url'] }}">{{ system['tar1090']['label'] }}</a></li>
        <li class="list_item"><a href="{{ system['graphs1090']['url'] }}">{{ system['graphs1090']['label'] }}</a></li>
        <li class="list_item"><a href="{{ system['piaware']['url'] }}">{{ system['piaware']['label'] }}</a></li>
    </ul>
    <h2>Closest Aircraft</h2>
    <ul>
        {% with identity = nearest_aircraft['identity'] %}
            <li class="list_item">Flight: 
                {% if identity['owner'] %}
                    {{ identity['owner'] }}
                {% endif %}
                {% if nearest_aircraft['flight'] is none %}
                    unknown
                {% else %}
                    <span class="code_text">{{ nearest_aircraft['flight'] }}</span>
                {% endif %}
            </li>
            <li class="list_item">{{ identity['manufacturer'] }} {{ identity['type'] }}
                ({{ nearest_aircraft['category'] }})
            </li>
        {% endwith %}
        {% with flightaware = nearest_aircraft['flightaware'] %}
            {% if flightaware is defined and flightaware|length  %}
                {% with origin = flightaware['origin'] %}
                    {% if origin is defined and origin is not none  %}
                        <li class="list_item">Origin: 
                            <span class="code_text">{{ origin['code_iata'] }}</span> |
                            {{ origin['name'] }}
                        </li>
                    {% else %}
                    <li class="list_item">Origin: unknown</li>
                    {% endif %}
                {% endwith %}
                {% with destination = flightaware['destination'] %}
                    {% if destination is defined and destination is not none  %}
                        <li class="list_item">Destination: 
                            <span class="code_text">{{ destination['code_iata'] }}</span> |
                            {{ destination['name'] }}
                        </li>
                    {% else %}
                    <li class="list_item">Destination: unknown</li>
                    {% endif %}
                {% endwith %}
                <div class="flightinfo">
                    <div class="flightinfo_timeline">
                        <div class="flightinfo_timeline_origin flightinfo_airport">
                            {% with origin = flightaware['origin'] %}
                                {% if origin is defined and origin is not none  %}
                                    {{ origin['code_iata'] }}
                                {% else %}
                                    <li class="list_item">unknown</li>
                                {% endif %}
                            {% endwith %}
                        </div>
                        <div class="flightinfo_timeline_progress"></div>
                        <div class="flightinfo_timeline_destination flightinfo_airport">
                            {% with destination = flightaware['destination'] %}
                                {% if destination is defined and destination is not none  %}
                                    {{ destination['code_iata'] }}
                                {% else %}
                                    <li class="list_item">unknown</li>
                                {% endif %}
                            {% endwith %}
                        </div>
                    </div>
                </div>
                <li class="list_item">Gate Departure
                    <ul>
                        <li class="list_item">Scheduled: {{ flightaware['scheduled_out']|format_datetime(local_timezone_name)}}</li>
                        <li class="list_item">Actual: {{ flightaware['actual_out']|format_datetime(local_timezone_name)}}</li>
                    </ul>
                </li>
                <li class="list_item">Takeoff
                    <ul>
                        <li class="list_item">Scheduled: {{ flightaware['scheduled_off']|format_datetime(local_timezone_name)}}</li>
                        <li class="list_item">Actual: {{ flightaware['actual_off']|format_datetime(local_timezone_name)}}</li>
                    </ul>
                </li>
                <li class="list_item">Landing
                    <ul>
                        <li class="list_item">Scheduled: {{ flightaware['scheduled_on']|format_datetime(local_timezone_name)}}</li>
                        <li class="list_item">Estimated: {{ flightaware['estimated_off']|format_datetime(local_timezone_name)}}</li>
                    </ul>
                </li>
                <li class="list_item">Gate Arrival
                    <ul>
                        <li class="list_item">Scheduled: {{ flightaware['scheduled_in']|format_datetime(local_timezone_name)}}</li>
                        <li class="list_item">Estimated: {{ flightaware['estimated_in']|format_datetime(local_timezone_name)}}</li>
                    </ul>
                </li>
                <li class="list_item">Departure diff: {{ flightaware['diff_departure_minutes'] }} minutes</li>
                <li class="list_item">Arrival diff: {{ flightaware['diff_arrival_minutes'] }} minutes</li>
            {% endif %}
        {% endwith %}
        {% with identity = nearest_aircraft['identity'] %}
            <li class="list_item">Registration: <span class="code_text">{{ identity['registration'] }}</span></li>
        {% endwith %}
        <li class="list_item">ADS-B ICAO: <span class="code_text">{{ nearest_aircraft['icao_24'] }}</span></li>
        <li class="list_item">Squawk: <span class="code_text">{{ nearest_aircraft['squawk'] }}</span></li>
        <li class="list_item">FlightAware:
            <a href="{{ nearest_aircraft['flightaware_urls']['live']}}">Live</a> |
            <a href="{{ nearest_aircraft['flightaware_urls']['redirect']}}">Redirect</a>
        </li>
        <li class="list_item">Distance: 
            {{ nearest_aircraft['distance']['direction'] }}, 
            <span class="code_text">{{ nearest_aircraft['distance']['nm']|round(2) }} NM</span>
            |
            <span class="code_text">
                {% if nearest_aircraft['distance']['km'] > 2 %}
                    {{ nearest_aircraft['distance']['km']|round(2) }} km
                {% else %}
                    {{ (nearest_aircraft['distance']['m'])|round|int }} m
                {% endif %}
            </span>
        </li>
        <li class="list_item">Altitude: <span class="code_text">{{ nearest_aircraft['alt_geom']}} ft</span></li>
        <li class="list_item">Ground Speed: <span class="code_text">{{ nearest_aircraft['gs'] }} KT</span></li>
        <li class="list_item">Vertical_rate: <span class="code_text">{{ nearest_aircraft['baro_rate'] }} ft/min</span></li>
        <li class="list_item">Track: {{ nearest_aircraft['movement']['direction'] }}, 
            <span class="code_text">{{ nearest_aircraft['movement']['track'] }}&deg;</span></li>
        <li class="list_item">&#x2191;&#x2197;&#x2192;&#x2198;&#x2193;&#x2199;&#x2190;&#x2196;</li>
    </ul>
    {% with identity = nearest_aircraft['identity'] %}
        {% if identity['image'] is defined and identity['image']|length  %}
            <img src="{{ identity['image']['src'] }}"/>
        {% else %}
            <p><em>(No image found for aircraft)</em></p>
        {% endif %}
    {% endwith %}
    <h2>Weather</h2>
    <ul>
        <li class="list_item">Weather: {{ weather_report['shortForecast'] }}</li>
        <li class="list_item">Temperature: 
            <span class="code_text">{{ weather_report['temperature'] }}&deg;F</span>
        </li>
        <li class="list_item">Humidity: {{ weather_report['relativeHumidity'] }}%</li>
        <li class="list_item">Precipitation: {{ weather_report['precipitation'] }}%</li>
        <li class="list_item">Wind: {{ weather_report['windDirection'] }} at {{ weather_report['windSpeed'] }}</li>
        <li class="list_item">Interval: {{ weather_report['startTime'] }} - {{ weather_report['endTime'] }}</li>
    </ul>
    <h2>Base Station</h2>
    <ul>
        <li class="list_item">Coordinates: 
            <span class="code_text">{{ receiver.lat }}</span>,
            <span class="code_text">{{ receiver.lon }}</span></li>
        <li class="list_item">Timezone: <span class="code_text">{{ local_timezone_name }}</span></li>
    </ul> 
    <h2>Ffring API</h2>
    <ul>
        <li class="list_item">{{ system['ffring_aircraft']['label'] }}:
            <a href="{{ system['ffring_aircraft']['url'] }}">{{ system['ffring_aircraft']['url'] }}</a>
        </li>
        <li class="list_item">{{ system['ffring_aircraft_nearest']['label'] }}:
            <a href="{{ system['ffring_aircraft_nearest']['url'] }}">{{ system['ffring_aircraft_nearest']['url'] }}</a>
        </li>
        <li class="list_item">{{ system['ffring_wtc']['label'] }}:
            <a href="{{ system['ffring_wtc']['url'] }}">{{ system['ffring_wtc']['url'] }}</a>
        </li>
    </ul>
    <h2>Dump1090 API</h2>
    <ul>
        <li class="list_item">Aircraft JSON:
            <a href="{{ system['urls']['aircraft'] }}">{{ system['urls']['aircraft'] }}</a>
        </li>
        <li class="list_item">Stats JSON:
            <a href="{{ system['urls']['stats'] }}">{{ system['urls']['stats'] }}</a>
        </li>
        <li class="list_item">Receiver JSON:
            <a href="{{ system['urls']['receiver'] }}">{{ system['urls']['receiver'] }}</a>
        </li>
    </ul>
    <h2>External API</h2>
    <ul>
        <li class="list_item">Weather:
            <a href="{{ weather_report['forcast_hourly_url'] }}">{{ weather_report['forcast_hourly_url'] }}</a>
        </li>

        {% if nearest_aircraft['image'] %}
            <li class="list_item">Plainspotters:
                <a href="{{ nearest_aircraft['image']['url'] }}">{{ nearest_aircraft['image']['url'] }}</a>
            </li>
        {% else %}
            <li class="list_item">Plainspotters: <em>(no image found)</em></li>
        {% endif %}
        <li class="list_item">HexDB: 
            <ul>
                <li class="list_item">Aircraft
                    <a href="{{ nearest_aircraft['hexdb']['aircraft_url'] }}">{{ nearest_aircraft['hexdb']['aircraft_url'] }}</a>
                </li>
                <li class="list_item">Conversion:
                    <a href="{{ nearest_aircraft['hexdb']['conversion_url'] }}">{{ nearest_aircraft['hexdb']['conversion_url'] }}</a>
                </li>
            </ul>
        </li>
        <li class="list_item">AdsbDB: 
            <ul>
                <li class="list_item">Aircraft
                    <a href="{{ nearest_aircraft['adsb_db']['aircraft_url'] }}">{{ nearest_aircraft['adsb_db']['aircraft_url'] }}</a>
                </li>
                <li class="list_item">Conversion:
                    <a href="{{ nearest_aircraft['adsb_db']['conversion_url'] }}">{{ nearest_aircraft['adsb_db']['conversion_url'] }}</a>
                </li>
            </ul>
        </li>
    </ul>
{% endblock %}
